---
title: "Exploratory Data Analysis"
subtitle: "PSTAT 131"
author: "Isabella Escamilla"
date: "3/18/23"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: show
    df_print: paged
---

<style type = "text/css">
  body{
  font-family: trebuchet ms, sans-serif;
}
.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    background-color: #8A5667;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE,
                      warning = FALSE, eval = TRUE)
library(tidyverse)
library(ggplot2)
library(extrafont)
library(showtext)
library(gt)
library(grid)
library(gridExtra)

```

```{r, include=FALSE}
loadfonts(device='win', quiet = FALSE)
font_add('trebuchet', 'C:/windows/fonts/trebuc.ttf')
showtext_auto()
```

```{r, include=FALSE}
theme_polyvore <- function(){
  font <- 'trebuchet'
  
  theme_minimal() %+replace%
    
    theme(
      # grid elements
      #panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.ticks = element_blank(),
      axis.line = element_line(),
      
      # text elements
      plot.title = element_text(
        family = font,
        size = 28,
        face = 'bold',
        hjust = 0,
        vjust = 2,
        margin = margin(b=5, t=5)),
      
      plot.subtitle = element_text(          #subtitle
                   family = font,            #font family
                   size = 14),               #font size
      
      plot.caption = element_text(           #caption
                   family = font,            #font family
                   size = 9,                 #font size
                   hjust = 1),               #right align
      
      axis.title = element_text(             #axis titles
                   family = font,            #font family
                   size = 20),               #font size
      
      axis.text = element_text(              #axis text
                   family = font,            #axis family
                   size = 16),                #font size
      
      axis.text.x = element_text(            #margin for axis text
                    margin=margin(5, b = 10)),
      
      axis.title.y = element_text(margin=margin(b=10, r=10), angle=90)
      

    )
}
```


## Exploratory Data Analysis
Now that we've tidied the data in a format that will be better suited for our analysis, we can begin by making some plots and seeing how the data is distributed.

First we will import the data and convert the appropriate variables into categorical data.

```{r}
# Reading the tidied data into R
outfits <- read.csv('tidy_data.csv')

# converting all character columns into factors
outfits[sapply(outfits, is.character)] <- lapply(outfits[sapply(outfits, is.character)], as.factor)
# I will only be using set_id to retrieve photos, so we will leave it be

outfits %>% head(5)
```


In the final data set, there are 14 variables:

Name | Variable description
---|---
`views` | The number of times an outfit has been viewed
`likes` | The number of likes an outfit received **(the response variable)**
`set_id` | identifies the particular outfit
`item_1` - `item_8` | gives the name of the item type for up to 8 items in an outfit
`color_1` - `color_4` | gives the unique colors found in the outfit for up to 4 different colors


### Likes
We will start by looking at the distribution of our response variable, `likes`.


```{r}
outfits %>% 
  ggplot(aes(x = likes)) + 
  geom_histogram(binwidth = 100, fill="#2C514C") +
  labs(x = 'Number of Likes', y = 'Count', title = 'Distribution of the Number of Likes') +
  coord_cartesian(xlim = c(0, 4000)) +
  theme_polyvore()
```

The number of likes ranges from 0 to around 3000, and the frequency decreases exponentially as the number of likes goes up. This follows the sort of logic you'd expect, where a select few get lots of likes while most go unseen.

### Items (Clothing Articles)
After an initial survey of the raw data, I noted that there were a lot of different item ids.

```{r}
# Finds the number of unique items in item_1 column
outfits$item_1 %>% unique() %>% length()
```
And indeed, there are 229 unique items in `item_1` alone! To further examine the nature of the item columns, we will look at a plot of the item frequencies in `item_1`.

```{r}
outfits %>% ggplot(aes(x = fct_infreq(item_1))) +
  geom_bar(fill = '#F08080') +
  labs(x = 'Item 1', title = 'Frequencies of item_1 Items') +
  theme_polyvore() +
  theme(axis.text.x = element_blank(), 
        panel.grid.major.x = element_blank(), 
        axis.line = element_blank())
```

From this plot, we can see that there are some items that are repeated a lot in the `item_1` slot, whereas others are more rare. Since there are 229 unique items present in this column, I've suppressed the item name text so that we can see the distribution better. 

To get a better look at the most frequent items seen in this slot, we will look at a bar plot of the top 10 `item_1` items by frequency.

```{r}
item1_t10 <- (sort(table(outfits$item_1), decreasing = TRUE) %>% names)[1:10]
outfits_item1_top10 <- outfits[outfits$item_1 %in% item1_t10,]

outfits_item1_top10 %>% 
  ggplot(aes(x = fct_infreq(item_1))) +
  geom_bar(fill="#583742") +
  labs(x = 'Item 1', title = 'Frequencies of Top 10 item_1 Items') +
  theme_polyvore() +
  theme(axis.text.x = element_text(size = 14, angle = 45),
        axis.line = element_blank())
```

We can see from this plot that tops, sweaters, and day dresses are the most frequent items in the item_1 slot. The rest are similar; they are either tops, jackets, or dresses. To get a better idea of what the other item columns look like, we'll construct a table with the top 5 items by frequency in each item column. 

```{r, class.source = 'fold-hide'}
item1_t5 <- (sort(table(outfits$item_1), decreasing = TRUE) %>% names)[1:5]
item2_t5 <- (sort(table(outfits$item_2), decreasing = TRUE) %>% names)[1:5]
item3_t5 <- (sort(table(outfits$item_3), decreasing = TRUE) %>% names)[1:5]
item4_t5 <- (sort(table(outfits$item_4), decreasing = TRUE) %>% names)[1:5]
item5_t5 <- (sort(table(outfits$item_5), decreasing = TRUE) %>% names)[1:5]
item6_t5 <- (sort(table(outfits$item_6), decreasing = TRUE) %>% names)[1:5]
item7_t5 <- (sort(table(outfits$item_7), decreasing = TRUE) %>% names)[1:5]
item8_t5 <- (sort(table(outfits$item_8), decreasing = TRUE) %>% names)[1:5]

item_freq_table <- data.frame(item_1 = item1_t5,
                              item_2 = item2_t5,
                              item_3 = item3_t5,
                              item_4 = item4_t5,
                              item_5 = item5_t5,
                              item_6 = item6_t5,
                              item_7 = item7_t5,
                              item_8 = item8_t5)

```

```{r}
item_freq_table %>% gt() %>% 
  tab_header(
    title = "Top 5 Items by Frequency"
  )
```

From looking at both the raw data and this table, a general pattern emerges: within each outfit, the items are sorted from most to least significant, with `item_1` being the most significant item and `item_8` being the least. The top items in `item_2` are still significant, with jackets being the most frequent and "bottoms" being common elements as well (shorts, jeans, skirts). `item_3` dips into shoe territory, and `item_4` through `item_8` can be seen mostly as the "accessory section". Another thing that is interesting to note from the table is that from `item_5` and onward, "None" is the most frequent item. We can check the proportion of "None"s pretty easily.

```{r}
# Gets proportion of data that has fewer than 5 items, fewer than 6 items, fewer than 7 items, and fewer than 8 items
props <- c(((filter(outfits, item_4 == 'None') %>% count()) / (outfits %>% count()))[1,1] %>% as.numeric(),
((filter(outfits, item_5 == 'None') %>% count()) / (outfits %>% count()))[1,1] %>% as.numeric(),
((filter(outfits, item_6 == 'None') %>% count()) / (outfits %>% count()))[1,1] %>% as.numeric(),
((filter(outfits, item_7 == 'None') %>% count()) / (outfits %>% count()))[1,1] %>% as.numeric(),
((filter(outfits, item_8 == 'None') %>% count()) / (outfits %>% count()))[1,1] %>% as.numeric())
props
```

With some simple arithmetic, this gives us a breakdown of the item number proportions:

* 8% of the outfits have 4 items,
* 15% have 5 items,
* 17% have 6 items,
* 19% have 7 items, and
* 41% have 8 items

### Colors
All of us understand that color plays an essential role in whether or not an outfit "works" (unless you're doing wardrobe for a 1947 film noir), so it will be good to see what kind of colors are represented in the data.

The color columns are similar to the item columns in the way they are ordered: `color_1` will have higher importance than `color_2` (and so on) in the outfit due to the way the information was extracted. Thus, we will look at the most popular colors in the `color_1` column.

```{r}
colors1 <- c('#fb5c5c', '#4a687d', '#ffdfbf',
            'gray16', '#9b938c', '#e2ba59', '#628d55',
            '#643b34', '#e3774c', '#6e4258')

outfits %>% 
  ggplot(aes(x = fct_infreq(color_1))) +
  geom_bar(fill = colors1) +
  labs(x = 'Color', title = 'Frequencies of Colors in color_1') +
  theme_polyvore() -> p1

colors2 <- c('gray16', '#4e4c5e', '#ffdfbf', '#e2ba59',
             '#9b938c', '#643b34', '#4a687d', '#628d55',
             '#fb5c5c', '#e3774c', '#6e4258')

outfits %>% 
  ggplot(aes(x = fct_infreq(color_2))) +
  geom_bar(fill = colors2) +
  labs(x = 'Color', title = 'Frequencies of Colors in color_2') +
  theme_polyvore() -> p2

grid.arrange(p1, p2, ncol=2)

```


Red clearly reigns supreme for `color_1`, followed by blue, white, and black. 


### Relationship between Items and Likes
Now that we have a good idea of what the different item columns hold, we can examine the items' relationship with the number of likes an outfit receives.




